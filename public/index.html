<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>KBase</title>
  
  <link href="knode/style.css" type="text/css" rel="stylesheet"/>
  <!-- jQuery and UI for draggable nodes -->
  <script type="text/javascript" src="knode/jquery/2.1.3/jquery.min.js"></script>
  <script type="text/javascript" src="knode/jqueryui/1.11.4/jquery-ui.min.js"></script>
  <!-- Raphael for SVG graphics -->
  <script type="text/javascript" src="knode/raphael/2.1.4/raphael-min.js"></script>
  <!-- Node map -->
  <script type="text/javascript" src="knode/nodemap.js"></script>
  
  <script type="text/javascript">
    
    function nodeClicked (node) {
      console.log ("node " + node.id + " has been clicked");
    }
    function initializeMapWithRoot(map) {
      // Ask for the root node in the database
      $.ajax({
        type: "POST",
        url : "/nodes/getRootNode",
        success : function(response) {
          if(response.length != 1) {
            $.error ("Expected one root node for kbase, got length of "+response.length);
            return;
          }
          var rootObj = response[0]; // {document, id, text}
          // Create the root node
          rootNode = map.createRootNode (rootObj.id, rootObj.document, rootObj.text);
          rootNode.callback = nodeClicked;
          
          // Create the child nodes directly attached to the root
          $.ajax({
            type: "POST",
            url : "/nodes/getChildrenNodes",
            data: JSON.stringify({id: rootNode.id}),
            contentType: 'application/json',
            success : function(response) {
              $.each (response, function () {
                var newNode = rootNode.addChildNode(this.id, this.document, this.text);
                newNode.callback = nodeClicked;
              });
            }
          });
        }
      });
    }
    
    $(document).ready(function() {
      var map, rootNode;
      map = $('#map').createNodeMap({scaleLevel: 0.55});
      rootNode = initializeMapWithRoot(map); 
    });
  </script>
  
</head>
<body>
  <div id="map" style="width:470px; height:450px; border: 2px solid black;">
  </div>
</body>
</html>